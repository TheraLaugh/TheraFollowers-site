<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>قائمة الحسابات | TheraFollowers</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <style>
    body {
      background-color: #0f0f0f;
      color: white;
      font-family: Tahoma, sans-serif;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    .fixed-header {
      background-color: #0077cc;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    .menu-button {
      font-size: 24px;
      color: white;
      cursor: pointer;
      padding: 5px 15px;
      font-weight: bold;
    }

    .site-name {
      font-size: 20px;
      color: white;
      font-weight: bold;
      text-align: center;
      flex-grow: 1;
    }

    .profile-pic {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }

    .side-menu {
      position: absolute;
      top: 60px;
      right: 10px;
      background-color: #222;
      border: 2px solid #0077cc;
      border-radius: 8px;
      padding: 10px;
      display: none;
      flex-direction: column;
      z-index: 1000;
      width: 160px;
    }

    .side-menu a {
      color: white;
      text-decoration: none;
      font-size: 14px;
      padding: 8px;
      border-bottom: 1px solid #0077cc;
    }

    main {
      padding: 20px;
    }

    h2 {
      color: gold;
      margin-top: 30px;
    }

    .blue-title {
      color: #00aaff;
      font-size: 20px;
      margin-top: 40px;
    }

    .message {
      font-size: 14px;
      color: #ccc;
      margin-bottom: 10px;
    }

    .gold-section {
      background-color: #222;
      border: 2px solid gold;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 30px;
    }

    .gold-account-box,
    .blue-account {
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      background-color: #1a1a1a;
      border: 2px solid #333;
    }

    .gold-account-box {
      background-color: #FFD700;
      color: black;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
    }

    .gold-account-box img,
    .account-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }

    .username {
      font-weight: bold;
      font-size: 16px;
      margin: 10px 0;
    }

    .follow-button {
      background-color: #00aaff;
      color: white;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 8px;
    }

    .upload-section {
      margin-top: 10px;
      text-align: center;
      display: none;
    }

    .upload-section input {
      background-color: #222;
      color: white;
      border: 1px solid #00aaff;
      padding: 6px;
      border-radius: 6px;
    }

    @media (max-width: 600px) {
      body {
        zoom: 1;
        overflow-x: hidden;
      }
    }

    @media (min-width: 601px) {
      body {
        zoom: 1;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <div class="fixed-header">
    <div class="menu-button" onclick="toggleMenu()">≡</div>
    <div class="site-name">TheraFollowers</div>
    <img src="" alt="صورة الملف الشخصي" class="profile-pic" id="profileImage">
    <div class="side-menu" id="sideMenu">
      <a href="login.html">تسجيل الدخول</a>
      <a href="services.html">الخدمات</a>
      <a href="followers.html">الإحصائيات</a>
      <a href="javascript:history.back()">← رجوع</a>
    </div>
  </div>

  <main>
    <div class="gold-section">
      <h2>الحسابات الذهبية</h2>
      <div class="message" id="goldMessage"></div>
      <div id="goldAccountsList"></div>
    </div>

    <div class="blue-title">الحسابات الزرقاء</div>
    <div class="message" id="blueMessage"></div>
    <div id="blueAccountsList"></div>
  </main>
  <script>
    function toggleMenu() {
      const menu = document.getElementById("sideMenu");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    function isLoggedInToInstagram() {
      return localStorage.getItem("instagramLoggedIn") === "true";
    }

    function followUser(username, element) {
      if (!isLoggedInToInstagram()) {
        alert("يجب عليك تسجيل الدخول إلى إنستقرام لإتمام عملية المتابعة");
        window.location.href = "login.html";
        return;
      }

      element.classList.add("expanded");

      setTimeout(() => {
        const confirmFollow = confirm(`هل قمت بمتابعة @${username}؟`);
        if (confirmFollow) {
          markAsFollowed(username);
          showUploadSection(username, element);
        }
      }, 800);
    }

    function showUploadSection(username, container) {
      const uploadDiv = document.createElement("div");
      uploadDiv.className = "upload-section";
      uploadDiv.innerHTML = `
        <p>📷 ارفع صورة تثبت أنك تابعت @${username}</p>
        <input type="file" accept="image/*" onchange="handleImageUpload(event, '${username}')">
      `;
      container.appendChild(uploadDiv);
      uploadDiv.style.display = "block";
    }

    function handleImageUpload(event, username) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function () {
        const imageData = reader.result;

        Tesseract.recognize(imageData, 'ara', {
          logger: m => console.log(m)
        }).then(({ data: { text } }) => {
          let status = "failed";
          if (text.includes(username) || text.includes("@" + username)) {
            status = "verified";
            alert(`✅ تم التحقق تلقائيًا من متابعة @${username}`);
          } else {
            alert(`❌ لم يتم العثور على اسم المستخدم داخل الصورة. سيتم إرسالها للمراجعة اليدوية.`);
          }

          const pending = JSON.parse(localStorage.getItem("pendingVerifications") || "[]");
          pending.push({ username, imageData, status });
          localStorage.setItem("pendingVerifications", JSON.stringify(pending));
          renderAccounts(); // تحديث الواجهة بعد التحقق
        });
      };
      reader.readAsDataURL(file);
    }

    function markAsFollowed(username) {
      let followed = JSON.parse(localStorage.getItem("followedAccounts") || "[]");
      if (!followed.includes(username)) {
        followed.push(username);
        localStorage.setItem("followedAccounts", JSON.stringify(followed));
      }
    }

    function renderAccounts() {
      const gold = JSON.parse(localStorage.getItem("goldAccounts") || "[]");
      const blue = JSON.parse(localStorage.getItem("blueAccounts") || "[]");
      const blocked = JSON.parse(localStorage.getItem("blockedBlueAccounts") || "[]");
      const followed = JSON.parse(localStorage.getItem("followedAccounts") || "[]");
      const profilePics = JSON.parse(localStorage.getItem("accountImages") || "{}");
      const verificationList = JSON.parse(localStorage.getItem("pendingVerifications") || "[]");

      const goldMsg = localStorage.getItem("goldMessage") || "";
      const blueMsg = localStorage.getItem("blueMessage") || "";

      document.getElementById("goldMessage").innerText = goldMsg;
      document.getElementById("blueMessage").innerText = blueMsg;

      const goldContainer = document.getElementById("goldAccountsList");
      const blueContainer = document.getElementById("blueAccountsList");

      goldContainer.innerHTML = "";
      blueContainer.innerHTML = "";

      gold.forEach(username => {
        if (!followed.includes(username)) {
          const item = document.createElement("div");
          item.className = "gold-account-box";
          const imgSrc = profilePics[username] || "";
          item.innerHTML = `
            <img src="${imgSrc}" alt="صورة الحساب">
            <span class="username">@${username}</span>
            <button class="follow-button" onclick="followUser('${username}', this.parentElement)">تابع</button>
          `;
          const statusObj = verificationList.find(v => v.username === username);
          if (statusObj) {
            const statusText = statusObj.status === "verified" ? "✅ تم التحقق" :
                               statusObj.status === "failed" ? "❌ فشل التحقق" :
                               "⏳ بانتظار التحقق";
            const statusEl = document.createElement("div");
            statusEl.style.color = "white";
            statusEl.style.fontSize = "13px";
            statusEl.innerText = statusText;
            item.appendChild(statusEl);
          }
          goldContainer.appendChild(item);
        }
      });

      blue.forEach(username => {
        if (!blocked.includes(username) && !followed.includes(username)) {
          const item = document.createElement("div");
          item.className = "blue-account";
          const imgSrc = profilePics[username] || "";
          item.innerHTML = `
            <div class="account-info">
              <img src="${imgSrc}" class="account-pic" alt="صورة الحساب">
              <span>@${username}</span>
            </div>
            <button class="follow-button" onclick="followUser('${username}', this.parentElement)">تابع</button>
          `;
          const statusObj = verificationList.find(v => v.username === username);
          if (statusObj) {
            const statusText = statusObj.status === "verified" ? "✅ تم التحقق" :
                               statusObj.status === "failed" ? "❌ فشل التحقق" :
                               "⏳ بانتظار التحقق";
            const statusEl = document.createElement("div");
            statusEl.style.color = "white";
            statusEl.style.fontSize = "13px";
            statusEl.innerText = statusText;
            item.appendChild(statusEl);
          }
          blueContainer.appendChild(item);
        }
      });
    }

    function loadProfileImage() {
      const imgUrl = localStorage.getItem("profilePic");
      if (imgUrl) {
        document.getElementById("profileImage").src = imgUrl;
      }
    }

    window.onload = function () {
      loadProfileImage();
      renderAccounts();
    };
  </script>
</body>
</html>