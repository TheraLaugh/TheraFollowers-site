<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>متابعة الحساب</title>
  <style>
    body {
      background-color: #0f0f0f;
      color: white;
      font-family: Tahoma;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .fixed-header {
      background-color: #1a1a1a;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-button {
      font-size: 28px;
      color: #00aaff;
      cursor: pointer;
      padding: 5px;
    }

    .site-name {
      font-size: 20px;
      color: #00aaff;
    }

    .status-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: white;
      border: 2px solid #00aaff;
      background-size: cover;
      background-position: center;
      margin-left: 10px;
    }

    .side-menu {
      display: none;
      position: absolute;
      top: 60px;
      right: 10px;
      background-color: #1a1a1a;
      border: 1px solid #00aaff;
      border-radius: 8px;
      padding: 10px;
      z-index: 999;
    }

    .side-menu ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .side-menu li {
      padding: 8px 12px;
      color: white;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }

    .side-menu li:hover {
      background-color: #00aaff;
    }

    .box {
      background-color: #1a1a1a;
      padding: 30px;
      border-radius: 10px;
      box-shadow: inset 5px 0 0 #00aaff;
      max-width: 400px;
      margin: 50px auto;
    }

    .box h2 {
      color: #00aaff;
      margin-bottom: 10px;
    }

    .box button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #00aaff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
    }

    .box p {
      font-size: 14px;
      color: #ccc;
    }

    #statusMsg {
      margin-top: 15px;
      color: #00ff99;
      font-size: 15px;
    }
  </style>
</head>
<body>

  <div class="fixed-header">
    <div class="menu-button" onclick="toggleMenu()">≡</div>
    <div class="site-name">shahin__rknldin</div>
    <div id="userCircle" class="status-circle" title="غير مسجل"></div>
  </div>

  <div id="sideMenu" class="side-menu">
    <ul>
      <li id="menu-login" onclick="goToLogin()">تسجيل الدخول</li>
      <li id="menu-points" style="display:none;">نقاطي</li>
      <li onclick="goToStats()">الإحصائيات</li>
    </ul>
  </div>

  <div class="box">
    <h2 id="accountName">...</h2>
    <p>سيتم فتح إنستقرام الآن لتتابع الحساب بنفسك</p>
    <button onclick="openInstagram()">تابع الآن من حسابك</button>
    <p id="statusMsg"></p>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const user = params.get("user");
    const type = params.get("type") || "blue";
    document.getElementById("accountName").innerText = user;

    function toggleMenu() {
      const menu = document.getElementById("sideMenu");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    function goToLogin() {
      window.location.href = "services.html";
    }

    function goToStats() {
      window.location.href = "followers.html";
    }

    function openInstagram() {
      const activeUser = localStorage.getItem("activeUser");

      // حفظ المتابعة مع النوع
      let followed = JSON.parse(localStorage.getItem("followedUsers") || "[]");
      followed.push({ username: user, type });
      localStorage.setItem("followedUsers", JSON.stringify(followed));

      // تسجيل من تابع الحساب
      if (activeUser) {
        const key = "followers_" + user;
        let followers = JSON.parse(localStorage.getItem(key) || "[]");
        if (!followers.includes(activeUser)) {
          followers.push(activeUser);
          localStorage.setItem(key, JSON.stringify(followers));
        }
      }

      // فتح إنستقرام الرسمي
      const url = `https://www.instagram.com/${user.replace("@", "")}`;
      window.open(url, "_blank", "width=600,height=700");

      // رسالة تأكيد
      document.getElementById("statusMsg").innerText = "تم فتح إنستقرام، تابع الحساب من هناك.";
    }

    window.onload = function () {
      const activeUser = localStorage.getItem("activeUser");
      if (activeUser) {
        document.getElementById("menu-login").innerText = "حسابي";
        document.getElementById("menu-points").style.display = "inline-block";
        document.getElementById("userCircle").style.backgroundImage = `url(${localStorage.getItem("profilePic")})`;
        document.getElementById("userCircle").title = activeUser;
      }
    };
  </script>

</body>
</html>